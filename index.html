
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Celestial Conquest Demo Updated</title>
<style>
body { font-family: Arial, sans-serif; background-color: #111; color: #eee; margin: 0; padding: 0;}
#game { display: flex; flex-direction: column; align-items: center; padding: 10px;}
#boosterArea, #handArea, #fieldArea { display: flex; flex-wrap: nowrap; overflow-x: auto; margin: 10px;}
.card { width: 120px; height: 180px; border: 2px solid #fff; margin: 5px; padding: 5px; background-color: #222; color: #fff; text-align: center; cursor: pointer;}
.common { border-color: #ccc; }
.rare { border-color: #00f; }
.epic { border-color: #a0f; }
.legendary { border-color: #ff0; }
button { margin: 5px; padding: 10px; cursor: pointer;}
#log { background-color: #222; border: 1px solid #555; width: 80%; height: 150px; overflow-y: auto; margin-top: 10px; padding: 5px;}
</style>
</head>
<body>
<div id="game">
<h1>Celestial Conquest Demo</h1>
<div>
<button id="newBoosterBtn">Open New Booster</button>
<button id="endTurnBtn">End Turn</button>
<button id="resetBtn">Reset Game</button>
</div>
<div id="players">
<p>Player Health: <span id="playerHealth">20</span></p>
<p>AI Health: <span id="aiHealth">20</span></p>
</div>
<div id="boosterArea"></div>
<h2>Your Hand</h2>
<div id="handArea"></div>
<h2>Field</h2>
<div id="fieldArea"></div>
<h2>Combat Log</h2>
<div id="log"></div>
</div>

<script>
let playerHealth = 20;
let aiHealth = 20;
let playerHand = [];
let aiHand = [];
let playerField = [];
let aiField = [];
let playerLocations = [];
let aiLocations = [];
let playerTurnDeployed = false;
let aiTurnDeployed = false;
const log = document.getElementById('log');
const boosterArea = document.getElementById('boosterArea');
const handArea = document.getElementById('handArea');
const fieldArea = document.getElementById('fieldArea');
const playerHealthSpan = document.getElementById('playerHealth');
const aiHealthSpan = document.getElementById('aiHealth');

const rarities = ['Common','Rare','Epic','Legendary'];

function randomRarity(){
    let roll = Math.random();
    if(roll < 0.5) return 'Common';
    if(roll < 0.75) return 'Rare';
    if(roll < 0.9) return 'Epic';
    return 'Legendary';
}

function updateDisplay(){
    playerHealthSpan.textContent = playerHealth;
    aiHealthSpan.textContent = aiHealth;
    handArea.innerHTML = '';
    playerHand.forEach((c,i)=>{
        let div = document.createElement('div');
        div.className = 'card '+c.rarity.toLowerCase();
        div.textContent = c.name+"\nHP:"+c.hp+"\nATK:"+c.atk+"\nRarity:"+c.rarity;
        div.onclick = ()=>playCard(c,i);
        handArea.appendChild(div);
    });
    fieldArea.innerHTML = '';
    [...playerField,...aiField].forEach(c=>{
        let div = document.createElement('div');
        div.className = 'card '+c.rarity.toLowerCase();
        div.textContent = c.name+"\nHP:"+c.hp+"\nATK:"+c.atk+"\nLOC:"+c.location+"\nRarity:"+c.rarity;
        fieldArea.appendChild(div);
    });
}

function logMsg(msg){ log.innerHTML += msg+"<br>"; log.scrollTop = log.scrollHeight; }

function generateCard(isLocation=false){
    const types = isLocation ? ['Volcanic Plains','Mystic Forest','Frozen Tundra'] : ['Hero','Villain','Creature'];
    let type = types[Math.floor(Math.random()*types.length)];
    return {name:type, hp:Math.floor(Math.random()*5)+5, atk:Math.floor(Math.random()*3)+1, location:isLocation?type:null, rarity: randomRarity(), isLocation:isLocation};
}

function openBooster(isPlayer=true){
    let booster = [];
    // ensure at least one location
    booster.push(generateCard(true));
    for(let i=0;i<2;i++){ booster.push(generateCard(false)); }
    if(isPlayer){
        playerHand.push(...booster);
    } else { aiHand.push(...booster); }
    updateDisplay();
}

function playCard(card,index){
    if(card.isLocation){
        if(playerLocations.length>0){ logMsg("You already have a location in play."); return; }
        playerLocations.push(card);
        playerField.push(card);
        playerHand.splice(index,1);
        logMsg("Player deployed location: "+card.name);
        updateDisplay();
        return;
    }
    // character placement
    if(playerLocations.length===0){ logMsg("Place a location first!"); return; }
    if(playerTurnDeployed){ logMsg("You can only deploy 1 character per turn."); return; }
    card.location = playerLocations[0].name;
    playerField.push(card);
    playerHand.splice(index,1);
    logMsg("Player deployed "+card.name+" to "+card.location);
    playerTurnDeployed = true;
    updateDisplay();
}

function aiPlay(){
    aiTurnDeployed = false;
    // deploy location if none
    if(aiLocations.length===0 && aiHand.length>0){
        for(let i=0;i<aiHand.length;i++){
            if(aiHand[i].isLocation){
                let card = aiHand.splice(i,1)[0];
                aiLocations.push(card);
                aiField.push(card);
                logMsg("AI deployed location: "+card.name);
                break;
            }
        }
    }
    // deploy one character if not yet deployed this turn
    if(aiHand.length>0 && !aiTurnDeployed){
        for(let i=0;i<aiHand.length;i++){
            if(!aiHand[i].isLocation){
                let card = aiHand.splice(i,1)[0];
                card.location = aiLocations[0].name;
                aiField.push(card);
                logMsg("AI deployed "+card.name+" to "+card.location);
                aiTurnDeployed = true;
                break;
            }
        }
    }
}

function endTurn(){
    // player combat against AI at same location
    playerField.forEach(pf => {
        if(pf.isLocation) return;
        aiField.forEach(af => {
            if(af.isLocation) return;
            if(pf.location === af.location){
                af.hp -= pf.atk;
                logMsg(pf.name+" attacks "+af.name+" for "+pf.atk+" damage.");
                if(Math.random()<0.5){ // 50% chance counterattack
                    pf.hp -= af.atk;
                    logMsg(af.name+" counterattacks "+pf.name+" for "+af.atk+" damage.");
                }
            }
        });
    });

    // remove defeated characters and adjust health
    playerField = playerField.filter(c => {
        if(c.isLocation) return true;
        if(c.hp<=0){ logMsg(c.name+" defeated!"); playerHealth -=1; return false; }
        return true;
    });
    aiField = aiField.filter(c => {
        if(c.isLocation) return true;
        if(c.hp<=0){ logMsg(c.name+" defeated!"); aiHealth -=1; return false; }
        return true;
    });

    aiPlay(); // AI turn
    playerTurnDeployed = false;
    updateDisplay();
}

document.getElementById('newBoosterBtn').onclick = ()=>openBooster(true);
document.getElementById('endTurnBtn').onclick = ()=>endTurn();
document.getElementById('resetBtn').onclick = ()=>{ location.reload(); };

// initial game setup
openBooster(true);
openBooster(false);
updateDisplay();
logMsg("Game start! Deploy a location first, then deploy one character per turn.");
</script>
</body>
</html>
